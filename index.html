latest 6

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bathhouse Categorizer</title>

<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  margin:0;
  padding:20px;
  background:#f4f4f4;
}

h2 { text-align:center; }

.panel {
  background:white;
  padding:16px;
  border-radius:14px;
  box-shadow:0 6px 25px rgba(0,0,0,.08);
  margin-bottom:15px;
}

button {
  cursor:pointer;
  border:none;
  border-radius:10px;
  padding:10px 12px;
  font-weight:600;
}

input[type="number"]{
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
}

.navBtn {
  width:48%;
  background:#444;
  color:white;
}

.category-row {
  display:flex;
  align-items:center;
  margin-bottom:6px;
}

.category-btn {
  flex:1;
  color:white;
}

.info-btn {
  width:40px;
  margin-left:6px;
  background:#ddd;
  font-weight:bold;
}

.cogs{background:#2e7d32;}
.expense{background:#1565c0;}
.special{background:#8e24aa;}

.progress-bar-container {
  background:#eee;
  border-radius:999px;
  overflow:hidden;
  height:16px;
  margin-bottom:8px;
}

.progress-bar {
  height:100%;
  background:#2e7d32;
  width:0%;
}

.small { font-size:13px; color:#555; }

.totalRow {
  display:flex;
  justify-content:space-between;
  font-size:13px;
  padding:4px 0;
}

.modal {
  display:none;
  position:fixed;
  z-index:1000;
  left:0; top:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.6);
}

.modal-content {
  background:white;
  margin:10% auto;
  padding:20px;
  width:95%;
  max-width:600px;
  border-radius:14px;
  max-height:90vh;
  overflow:auto;
}
</style>
</head>

<body>

<h2>Bathhouse Categorizer</h2>

<input type="file" id="csvFile" accept=".csv">

<div id="mappingPanel" class="panel" style="display:none;"></div>

<div id="app" style="display:none;">

<!-- üîé SEARCH PANEL -->
<div class="panel">
  <b>Find Transaction</b><br><br>
  <input id="searchAmount" type="number" step="0.01" placeholder="Enter amount">
  <button onclick="searchByAmount()">Find</button>
  <button onclick="jumpToNextReceipt()">Next With Receipt</button>
</div>

<div class="panel">
  <div class="progress-bar-container">
    <div id="progressBar" class="progress-bar"></div>
  </div>
  <div id="progressText" class="small"></div>
</div>

<div class="panel">

<div id="cardTitle">Upload CSV to begin</div>
<div id="cardMeta" class="small"></div>
<div id="currentCategory" class="small" style="margin-top:6px;"></div>

<div id="suggestionBox" class="small" style="margin-top:10px;"></div>

<div style="margin-top:10px;">
  <input type="file" id="receiptUpload" accept="image/*" style="display:none;">
  <button onclick="triggerReceiptUpload()">üìé Upload Receipt</button>
  <button onclick="viewReceipt()">üëÅ View Receipt</button>
  <button onclick="openSplitEditor()">üßæ Split Transaction</button>
</div>

<hr>

<div style="display:flex; justify-content:space-between; margin-bottom:12px;">
<button class="navBtn" onclick="goBack()">‚¨Ö Back</button>
<button class="navBtn" onclick="goNext()">Next ‚û°</button>
</div>

<div id="categoryButtons"></div>

</div>

<div class="panel">
<h4>Totals</h4>
<div id="totals"></div>
</div>

<button onclick="exportExcel()">Export to Excel</button>
<button onclick="clearProgress()" style="background:#c62828;color:white;margin-top:10px;">Reset Saved Progress</button>

</div>

<!-- INFO MODAL -->
<div id="infoModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <button onclick="closeModal()" style="margin-top:15px;background:#444;color:white;width:100%;">Close</button>
  </div>
</div>

<!-- SPLIT MODAL -->
<div id="splitModal" class="modal">
  <div class="modal-content">
    <h3>Split Transaction</h3>
    <div id="splitList"></div>

    <div style="margin-top:10px;">
      <input id="splitAmount" type="number" step="0.01" placeholder="Amount">
      <select id="splitCategory"></select>
      <button onclick="addSplit()">Add</button>
    </div>

    <div style="margin-top:15px;">
      <button onclick="saveSplits()">Save Splits</button>
      <button onclick="closeSplit()">Cancel</button>
    </div>
  </div>
</div>

<script>

const STORAGE_KEY = "bathhouse_categorizer_v9";

let rawRows=[], data=[], headers=[];
let currentIndex=0;

/* ================= SEARCH FEATURES ================= */

function searchByAmount(){
  const amt = parseFloat(document.getElementById("searchAmount").value);
  if(isNaN(amt)) return;

  for(let i=0;i<data.length;i++){
    if(Math.abs(data[i].Amount - amt) < 0.01){
      currentIndex=i;
      showCard();
      return;
    }
  }
  alert("No transaction found with that amount.");
}

function jumpToNextReceipt(){
  for(let i=currentIndex+1;i<data.length;i++){
    if(data[i].Receipt){
      currentIndex=i;
      showCard();
      return;
    }
  }
  alert("No more receipts found.");
}

/* ================= RECEIPT ================= */

function triggerReceiptUpload(){
  document.getElementById("receiptUpload").click();
}

document.getElementById("receiptUpload").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(evt){
    const img = new Image();
    img.onload = function(){
      const canvas = document.createElement("canvas");
      const maxWidth = 1000;
      const scale = Math.min(1, maxWidth / img.width);
      canvas.width = img.width * scale;
      canvas.height = img.height * scale;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      data[currentIndex].Receipt = canvas.toDataURL("image/jpeg", 0.7);
      saveProgress();
      showCard();
    };
    img.src = evt.target.result;
  };
  reader.readAsDataURL(file);
});

function viewReceipt(){
  const item = data[currentIndex];
  if(!item.Receipt){
    alert("No receipt uploaded.");
    return;
  }

  document.getElementById("modalTitle").innerText="Receipt";
  document.getElementById("modalBody").innerHTML=
  `<img id="receiptImage" src="${item.Receipt}" style="max-width:100%;cursor:zoom-in;">`;

  document.getElementById("infoModal").style.display="block";

  let zoom=false;
  document.getElementById("receiptImage").onclick=function(){
    zoom=!zoom;
    this.style.transform=zoom?"scale(2)":"scale(1)";
  };
}

/* ================= SPLIT ================= */

function openSplitEditor(){
  const select=document.getElementById("splitCategory");
  select.innerHTML="";
  categories.forEach(c=>{
    const opt=document.createElement("option");
    opt.value=c.name;
    opt.innerText=c.name;
    select.appendChild(opt);
  });

  renderSplitList();
  document.getElementById("splitModal").style.display="block";
}

function renderSplitList(){
  const item=data[currentIndex];
  if(!item.Splits) item.Splits=[];
  let html="";
  let total=0;

  item.Splits.forEach((s,i)=>{
    total+=s.amount;
    html+=`
    <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
      <div>${s.category}</div>
      <div>$${s.amount.toFixed(2)}</div>
      <button onclick="removeSplit(${i})">X</button>
    </div>`;
  });

  html+=`<hr>Split Total: $${total.toFixed(2)}<br>Original: $${item.Amount.toFixed(2)}`;
  document.getElementById("splitList").innerHTML=html;
}

function addSplit(){
  const amt=parseFloat(document.getElementById("splitAmount").value);
  const cat=document.getElementById("splitCategory").value;
  if(!amt || amt<=0) return;
  if(!data[currentIndex].Splits) data[currentIndex].Splits=[];
  data[currentIndex].Splits.push({amount:amt,category:cat});
  document.getElementById("splitAmount").value="";
  renderSplitList();
}

function removeSplit(i){
  data[currentIndex].Splits.splice(i,1);
  renderSplitList();
}

function saveSplits(){
  const item=data[currentIndex];
  const splitTotal=item.Splits.reduce((a,b)=>a+b.amount,0);
  if(Math.abs(splitTotal-item.Amount)>0.01){
    alert("Split must equal original amount.");
    return;
  }
  saveProgress();
  updateTotals();
  updateProgress();
  closeSplit();
  showCard();
}

function closeSplit(){
  document.getElementById("splitModal").style.display="none";
}

/* ================= (Rest of your original logic remains unchanged) ================= */

/* Your category array, suggestion logic, mapping logic, totals, progress,
   saveProgress, loadProgress etc. remain exactly as in your working file */

</script>
</body>
</html>