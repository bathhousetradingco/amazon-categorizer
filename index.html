 The latest one 

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bathhouse Categorizer</title>

<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body { font-family:-apple-system,BlinkMacSystemFont,sans-serif; margin:0; padding:20px; background:#f4f4f4; }
h2 { text-align:center; }
.panel { background:white; padding:16px; border-radius:14px; box-shadow:0 6px 25px rgba(0,0,0,.08); margin-bottom:15px; }
button { cursor:pointer; border:none; border-radius:10px; padding:10px; font-weight:600; margin:4px 0; }
.navBtn { width:48%; background:#444; color:white; }
.category-row { display:flex; align-items:center; margin-bottom:6px; }
.category-btn { flex:1; color:white; }
.info-btn { width:40px; margin-left:6px; background:#ddd; font-weight:bold; }
.cogs{background:#2e7d32;}
.expense{background:#1565c0;}
.special{background:#8e24aa;}
.progress-bar-container { background:#eee; border-radius:999px; overflow:hidden; height:16px; margin-bottom:8px; }
.progress-bar { height:100%; background:#2e7d32; width:0%; transition:width .3s ease; }
.small { font-size:13px; color:#555; }
.totalRow { display:flex; justify-content:space-between; font-size:13px; padding:4px 0; }
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,.6); }
.modal-content { background:white; margin:5% auto; padding:20px; width:95%; max-width:800px; border-radius:14px; max-height:90vh; overflow:auto; }
</style>
</head>
<body>

<h2>Bathhouse Categorizer</h2>
<input type="file" id="csvFile" accept=".csv">

<div id="mappingPanel" class="panel" style="display:none;"></div>

<div id="app" style="display:none;">

<div class="panel">
<div class="progress-bar-container">
<div id="progressBar" class="progress-bar"></div>
</div>
<div id="progressText" class="small"></div>
</div>

<div class="panel">
<div id="cardTitle">Upload CSV to begin</div>
<div id="cardMeta" class="small"></div>
<div id="currentCategory" class="small" style="margin-top:6px;"></div>

<div style="margin-top:10px;">
<input type="file" id="receiptUpload" accept="image/*" style="display:none;">
<button onclick="triggerReceiptUpload()">üìé Upload Receipt</button>
<button onclick="viewReceipt()">üëÅ View Receipt</button>
<button onclick="openSplitEditor()">üßæ Split Transaction</button>
</div>

<hr>

<div style="display:flex; justify-content:space-between; margin-bottom:12px;">
<button class="navBtn" onclick="goBack()">‚¨Ö Back</button>
<button class="navBtn" onclick="goNext()">Next ‚û°</button>
</div>

<div id="categoryButtons"></div>
</div>

<div class="panel">
<h4>Totals</h4>
<div id="totals"></div>
</div>

<button onclick="exportExcel()">Export to Excel</button>
<button onclick="clearProgress()" style="background:#c62828;color:white;margin-top:10px;">Reset Saved Progress</button>
</div>

<!-- Receipt / Info Modal -->
<div id="infoModal" class="modal">
<div class="modal-content">
<h3 id="modalTitle"></h3>
<div id="modalBody"></div>
<button onclick="closeModal()" style="margin-top:15px;background:#444;color:white;width:100%;">Close</button>
</div>
</div>

<!-- Split Modal -->
<div id="splitModal" class="modal">
<div class="modal-content">
<h3>Split Transaction</h3>
<div id="splitList"></div>
<div style="margin-top:10px;">
<input id="splitAmount" type="number" step="0.01" placeholder="Amount">
<select id="splitCategory"></select>
<button onclick="addSplit()">Add</button>
</div>
<div style="margin-top:15px;">
<button onclick="saveSplits()">Save Splits</button>
<button onclick="closeSplit()">Cancel</button>
</div>
</div>
</div>

<script>

const STORAGE_KEY="bathhouse_categorizer_v7";
let rawRows=[], data=[], headers=[];
let currentIndex=0;

/* ================= CSV ================= */

document.getElementById("csvFile").addEventListener("change",function(e){
localStorage.removeItem(STORAGE_KEY);
const file=e.target.files[0];
if(!file)return;
Papa.parse(file,{
header:true,
skipEmptyLines:true,
complete:function(res){
rawRows=res.data;
headers=Object.keys(rawRows[0]||{});
showMapping();
}});
});

function showMapping(){
const panel=document.getElementById("mappingPanel");
panel.style.display="block";
panel.innerHTML=`
<h4>Map Columns</h4>
Title:<br>${dropdown("mapTitle")}<br><br>
Amount:<br>${dropdown("mapAmount")}<br><br>
Vendor:<br>${dropdown("mapVendor",true)}<br><br>
Date:<br>${dropdown("mapDate",true)}<br><br>
<button onclick="confirmMapping()">Confirm</button>`;
}

function dropdown(id,allowEmpty=false){
let html=`<select id="${id}">`;
if(allowEmpty) html+=`<option value="">--None--</option>`;
headers.forEach(h=>html+=`<option value="${h}">${h}</option>`);
return html+="</select>";
}

function confirmMapping(){
const t=document.getElementById("mapTitle").value;
const a=document.getElementById("mapAmount").value;
const v=document.getElementById("mapVendor").value;
const d=document.getElementById("mapDate").value;

data=rawRows.map(r=>({
Title:r[t]||"",
Amount:parseFloat(String(r[a]).replace(/[$,]/g,""))||0,
Vendor:v?r[v]||"",
Date:d?r[d]||"",
Category:"",
Receipt:"",
Splits:[]
}));

document.getElementById("mappingPanel").style.display="none";
document.getElementById("app").style.display="block";
renderCategories();
showCard();
updateTotals();
updateProgress();
saveProgress();
}

/* ================= Receipt ================= */

function triggerReceiptUpload(){ document.getElementById("receiptUpload").click(); }

document.getElementById("receiptUpload").addEventListener("change",function(e){
const file=e.target.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=function(evt){
const img=new Image();
img.onload=function(){
const canvas=document.createElement("canvas");
const maxWidth=1000;
const scale=maxWidth/img.width;
canvas.width=maxWidth;
canvas.height=img.height*scale;
const ctx=canvas.getContext("2d");
ctx.drawImage(img,0,0,canvas.width,canvas.height);
data[currentIndex].Receipt=canvas.toDataURL("image/jpeg",0.7);
saveProgress();
alert("Receipt saved.");
};
img.src=evt.target.result;
};
reader.readAsDataURL(file);
});

function viewReceipt(){
const item=data[currentIndex];
if(!item.Receipt){ alert("No receipt."); return; }
document.getElementById("modalTitle").innerText="Receipt";
document.getElementById("modalBody").innerHTML=
`<img id="receiptImage" src="${item.Receipt}" style="max-width:100%;cursor:zoom-in;transition:transform .2s ease;">`;
document.getElementById("infoModal").style.display="block";
let zoom=false;
document.getElementById("receiptImage").onclick=function(){
zoom=!zoom;
this.style.transform=zoom?"scale(2)":"scale(1)";
};
}

/* ================= Splits ================= */

function openSplitEditor(){
const item=data[currentIndex];
const select=document.getElementById("splitCategory");
select.innerHTML="";
renderCategoriesOptions(select);
renderSplitList();
document.getElementById("splitModal").style.display="block";
}

function renderCategoriesOptions(select){
const cats=[
"COGS ‚Äì Ingredients","COGS ‚Äì Packaging","COGS ‚Äì Resale Inventory",
"COGS ‚Äì Production Supplies","COGS ‚Äì Shipping from Suppliers",
"Equipment","Advertising & Marketing","Website & Software",
"Merchant Processing Fees","Insurance","Utilities",
"Professional Services","Needs Review"];
cats.forEach(c=>{
const opt=document.createElement("option");
opt.value=c;
opt.innerText=c;
select.appendChild(opt);
});
}

function renderSplitList(){
const item=data[currentIndex];
let html="";
let total=0;
item.Splits.forEach((s,i)=>{
total+=s.amount;
html+=`<div>${s.category} ‚Äî $${s.amount.toFixed(2)}
<button onclick="removeSplit(${i})">X</button></div>`;
});
html+=`<hr>Split Total: $${total.toFixed(2)}<br>Original: $${item.Amount.toFixed(2)}`;
document.getElementById("splitList").innerHTML=html;
}

function addSplit(){
const amt=parseFloat(document.getElementById("splitAmount").value);
const cat=document.getElementById("splitCategory").value;
if(!amt||amt<=0)return;
data[currentIndex].Splits.push({amount:amt,category:cat});
document.getElementById("splitAmount").value="";
renderSplitList();
}

function removeSplit(i){
data[currentIndex].Splits.splice(i,1);
renderSplitList();
}

function saveSplits(){
const item=data[currentIndex];
const total=item.Splits.reduce((a,b)=>a+b.amount,0);
if(Math.abs(total-item.Amount)>0.01){
alert("Split must equal original amount.");
return;
}
item.Category="SPLIT";
closeSplit();
updateTotals();
saveProgress();
showCard();
}

function closeSplit(){ document.getElementById("splitModal").style.display="none"; }

/* ================= Navigation ================= */

function showCard(){
if(!data.length)return;
const item=data[currentIndex];
document.getElementById("cardTitle").innerText=item.Title+(item.Receipt?" üìé":"");
document.getElementById("cardMeta").innerHTML=
(item.Vendor?`Vendor: ${item.Vendor}<br>`:"")+
(item.Date?`Date: ${item.Date}<br>`:"")+
`Amount: $${item.Amount.toFixed(2)}`;
document.getElementById("currentCategory").innerText=
item.Splits.length?"Current: SPLIT":"Current: "+(item.Category||"‚Äî");
}

function goBack(){ if(currentIndex>0){ currentIndex--; showCard(); } }
function goNext(){ if(currentIndex<data.length-1){ currentIndex++; showCard(); } }

function updateTotals(){
let totals={};
data.forEach(d=>{
if(d.Splits.length){
d.Splits.forEach(s=>{
totals[s.category]=(totals[s.category]||0)+s.amount;
});
}else if(d.Category){
totals[d.Category]=(totals[d.Category]||0)+d.Amount;
}
});
let html="";
Object.keys(totals).forEach(k=>{
html+=`<div class="totalRow"><div>${k}</div><div>$${totals[k].toFixed(2)}</div></div>`;
});
document.getElementById("totals").innerHTML=html;
}

function updateProgress(){
const total=data.length;
const done=data.filter(d=>d.Category||d.Splits.length).length;
const percent=Math.round((done/total)*100);
document.getElementById("progressBar").style.width=percent+"%";
document.getElementById("progressText").innerText=
`${done} of ${total} categorized (${percent}%)`;
}

function saveProgress(){
localStorage.setItem(STORAGE_KEY,JSON.stringify({data,currentIndex}));
}

function loadProgress(){
const saved=localStorage.getItem(STORAGE_KEY);
if(!saved)return;
const parsed=JSON.parse(saved);
data=parsed.data||[];
currentIndex=parsed.currentIndex||0;
if(data.length){
document.getElementById("app").style.display="block";
showCard();
updateTotals();
updateProgress();
}
}

function clearProgress(){ localStorage.removeItem(STORAGE_KEY); location.reload(); }

function exportExcel(){
const ws=XLSX.utils.json_to_sheet(data);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Categorized");
XLSX.writeFile(wb,"Categorized.xlsx");
}

window.onload=loadProgress;

</script>
</body>
</html>