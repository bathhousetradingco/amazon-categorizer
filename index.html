Latest 9

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bathhouse Categorizer</title>

<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  margin:0;
  padding:20px;
  background:#f4f4f4;
}
h2 { text-align:center; }
.panel {
  background:white;
  padding:16px;
  border-radius:14px;
  box-shadow:0 6px 25px rgba(0,0,0,.08);
  margin-bottom:15px;
}
button {
  cursor:pointer;
  border:none;
  border-radius:10px;
  padding:12px;
  font-weight:600;
}
input, select {
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
}
.navBtn {
  width:48%;
  background:#444;
  color:white;
}
.category-row {
  display:flex;
  align-items:center;
  margin-bottom:6px;
}
.category-btn {
  flex:1;
  color:white;
}
.cogs{background:#2e7d32;}
.expense{background:#1565c0;}
.special{background:#8e24aa;}
.progress-bar-container {
  background:#eee;
  border-radius:999px;
  overflow:hidden;
  height:16px;
  margin-bottom:8px;
}
.progress-bar {
  height:100%;
  background:#2e7d32;
  width:0%;
}
.small { font-size:13px; color:#555; }
.totalRow {
  display:flex;
  justify-content:space-between;
  font-size:13px;
  padding:4px 0;
}
.previewRow {
  display:flex;
  justify-content:space-between;
  font-size:13px;
  padding:4px 0;
  background:#f3f9ff;
}
</style>
</head>

<body>

<h2>Bathhouse Categorizer</h2>

<input type="file" id="csvFile" accept=".csv">
<div id="mappingPanel" class="panel" style="display:none;"></div>

<div id="app" style="display:none;">

<div class="panel">
<label><input type="checkbox" id="uncategorizedToggle"> Navigate only Uncategorized</label>
<button onclick="jumpToFirstUncategorized()">Jump to First Uncategorized</button>
</div>

<div class="panel">
<div class="progress-bar-container">
<div id="progressBar" class="progress-bar"></div>
</div>
<div id="progressText" class="small"></div>
</div>

<div class="panel">
<div id="cardTitle"></div>
<div id="cardMeta" class="small"></div>
<div id="currentCategory" class="small" style="margin-top:6px;"></div>

<hr>

<div style="display:flex; justify-content:space-between; margin-bottom:12px;">
<button class="navBtn" onclick="goBack()">⬅ Back</button>
<button class="navBtn" onclick="goNext()">Next ➡</button>
</div>

<div id="categoryButtons"></div>
</div>

<div class="panel">
<h4>Totals (Live Preview)</h4>
<div id="totals"></div>
</div>

</div>

<script>

const STORAGE_KEY="bathhouse_categorizer_v13";
let rawRows=[], data=[], headers=[];
let currentIndex=0;
let previewCategory=null;

const categories=[
{name:"COGS – Ingredients",class:"cogs"},
{name:"COGS – Packaging",class:"cogs"},
{name:"COGS – Resale Inventory",class:"cogs"},
{name:"COGS – Production Supplies",class:"cogs"},
{name:"COGS – Shipping from Suppliers",class:"cogs"},
{name:"Equipment",class:"expense"},
{name:"Advertising & Marketing",class:"expense"},
{name:"Website & Software",class:"expense"},
{name:"Merchant Processing Fees",class:"expense"},
{name:"Insurance",class:"expense"},
{name:"Utilities",class:"expense"},
{name:"Professional Services",class:"expense"},
{name:"Needs Review",class:"special"}
];

/* ================= CSV IMPORT ================= */

document.getElementById("csvFile").addEventListener("change",function(e){
const file=e.target.files[0];
if(!file)return;

Papa.parse(file,{
header:true,
skipEmptyLines:true,
complete:function(res){
rawRows=res.data;
headers=Object.keys(rawRows[0]||{});
showMapping();
}
});
});

function showMapping(){
const panel=document.getElementById("mappingPanel");
panel.style.display="block";
panel.innerHTML=`
<h4>Map Columns</h4>
Title:<br>${dropdown("mapTitle")}<br><br>
Amount:<br>${dropdown("mapAmount")}<br><br>
Vendor (optional):<br>${dropdown("mapVendor",true)}<br><br>
Date (optional):<br>${dropdown("mapDate",true)}<br><br>
Existing Category (optional):<br>${dropdown("mapCategory",true)}<br><br>
<button onclick="confirmMapping()">Confirm</button>
`;
}

function dropdown(id,allowEmpty=false){
let html=`<select id="${id}">`;
if(allowEmpty)html+=`<option value="">--None--</option>`;
headers.forEach(h=>html+=`<option value="${h}">${h}</option>`);
return html+="</select>";
}

function confirmMapping(){
const t=document.getElementById("mapTitle").value;
const a=document.getElementById("mapAmount").value;
const v=document.getElementById("mapVendor").value;
const d=document.getElementById("mapDate").value;
const c=document.getElementById("mapCategory").value;

data=rawRows.map(r=>({
Title:r[t]||"",
Amount:parseFloat(String(r[a]).replace(/[$,]/g,""))||0,
Vendor:v?r[v]||"":"",
Date:d?r[d]||"",
Category:c?(r[c]||""):"",
Splits:[]
}));

document.getElementById("mappingPanel").style.display="none";
document.getElementById("app").style.display="block";

renderCategories();
showCard();
updateTotals();
updateProgress();
}

/* ================= NAVIGATION ================= */

function passesFilter(index){
if(document.getElementById("uncategorizedToggle").checked){
if(data[index].Category)return false;
}
return true;
}

function goNext(){
for(let i=currentIndex+1;i<data.length;i++){
if(passesFilter(i)){
currentIndex=i;
showCard();
return;
}}
}

function goBack(){
for(let i=currentIndex-1;i>=0;i--){
if(passesFilter(i)){
currentIndex=i;
showCard();
return;
}}
}

function jumpToFirstUncategorized(){
for(let i=0;i<data.length;i++){
if(!data[i].Category){
currentIndex=i;
showCard();
return;
}}
alert("No Uncategorized transactions found.");
}

/* ================= DISPLAY ================= */

function renderCategories(){
const div=document.getElementById("categoryButtons");
div.innerHTML="";
categories.forEach(c=>{
const row=document.createElement("div");
row.className="category-row";

const btn=document.createElement("button");
btn.className="category-btn "+c.class;
btn.innerText=c.name;
btn.onclick=()=>categorize(c.name);
btn.onmouseenter=()=>previewCategory=c.name,updateTotals();
btn.onmouseleave=()=>previewCategory=null,updateTotals();

row.appendChild(btn);
div.appendChild(row);
});
}

function categorize(name){
data[currentIndex].Category=name;
previewCategory=null;
updateTotals();
updateProgress();
showCard();
}

function showCard(){
if(!data.length)return;
const item=data[currentIndex];
document.getElementById("cardTitle").innerText=item.Title;
document.getElementById("cardMeta").innerHTML=
(item.Vendor?`Vendor: ${item.Vendor}<br>`:"")+
(item.Date?`Date: ${item.Date}<br>`:"")+
`Amount: $${item.Amount.toFixed(2)}`;
document.getElementById("currentCategory").innerText="Current: "+(item.Category||"—");
}

/* ================= TOTALS (LIVE PREVIEW) ================= */

function updateTotals(){
let totals={};
categories.forEach(c=>totals[c.name]=0);

data.forEach((d,i)=>{
if(d.Category){
totals[d.Category]+=d.Amount;
}
});

// preview logic
if(previewCategory && !data[currentIndex].Category){
totals[previewCategory]+=data[currentIndex].Amount;
}

const div=document.getElementById("totals");
div.innerHTML="";
Object.keys(totals).forEach(k=>{
if(previewCategory===k && !data[currentIndex].Category){
div.innerHTML+=`<div class="previewRow"><div>${k}</div><div>$${totals[k].toFixed(2)}</div></div>`;
}else{
div.innerHTML+=`<div class="totalRow"><div>${k}</div><div>$${totals[k].toFixed(2)}</div></div>`;
}
});
}

function updateProgress(){
const total=data.length;
const done=data.filter(d=>d.Category).length;
const percent=total?Math.round((done/total)*100):0;
document.getElementById("progressBar").style.width=percent+"%";
document.getElementById("progressText").innerText=
`${done} of ${total} categorized (${percent}%)`;
}

</script>
</body>
</html>
